<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>rust-start | ixout's blog</title><meta name="author" content="ixout"><meta name="copyright" content="ixout"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="rust">
<meta property="og:type" content="website">
<meta property="og:title" content="rust-start">
<meta property="og:url" content="https://ixout.github.io/%E6%9A%82%E7%BD%AE/rust-start.html">
<meta property="og:site_name" content="ixout&#39;s blog">
<meta property="og:description" content="rust">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/2cc667bb30dce44a47.jpg">
<meta property="article:published_time" content="2024-03-10T03:22:30.000Z">
<meta property="article:modified_time" content="2024-03-14T11:11:05.777Z">
<meta property="article:author" content="ixout">
<meta property="article:tag" content="rust">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/2cc667bb30dce44a47.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ixout.github.io/%E6%9A%82%E7%BD%AE/rust-start.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'rust-start',
  isPost: false,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-03-14 19:11:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/poem.css"><link rel="stylesheet" href="/css/footerb.css"><link rel="stylesheet" href="/css/bolang.css"><link rel="stylesheet" href="/css/jzbar.css"><link rel="stylesheet" href="/css/trans.css"><link rel="stylesheet" href="/css/gundongtiao.css"><link rel="stylesheet" href="/css/shubiao.css"><link rel="stylesheet" href="/css/fengche.css"><link rel="stylesheet" href="/css/alitubiao.css"><link rel="stylesheet" href="/css/fps.css"><span id="fps"></span><link rel="stylesheet" href="/css/yituliu.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3930344_38rvofbfw64.css" media="defer" onload="this.media='all'"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ixout's blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="pokeball-back"></div><div class="pokeball-loading"><div class="pokeball" id="pokeball-normal"></div><div class="pokeball" id="pokeball-great"></div><div class="pokeball" id="pokeball-ultra"></div><div class="pokeball" id="pokeball-master"></div><div class="pokeball" id="pokeball-safari"></div></div></div><script async="async">const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})
setTimeout(function(){preloader.endLoading();}, 7000);

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="/css/jzbar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">64</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-hanbao"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-fenlei"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-youlian"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-fantuan"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-home-page" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="ixout's blog"><span class="site-name">ixout's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-hanbao"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-fenlei"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-youlian"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-fantuan"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="page-site-info"><h1 id="site-title">rust-start</h1></div></header><main class="layout" id="content-inner"><div id="page"><div id="article-container"><h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><p><strong>1</strong></p>
<p>Rust 是强类型语言</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">a = <span class="number">4.56</span>; </span><br><span class="line">a = <span class="number">456</span>;</span><br></pre></td></tr></table></figure>
<p>在这样声明一个变量后,下面三个句子都是错误的</p>
<p>第一行的错误在于当声明 a 是 123 以后，a 就被确定为整型数字，不能把字符串类型的值赋给它。</p>
<p>第二行的错误在于自动转换数字精度有损失，Rust 语言不允许精度有损失的自动数据类型转换。</p>
<p>第三行的错误在于 a 不是个可变变量。</p>
<p>第一行的错误在于当声明 a 是 123 以后，a 就被确定为整型数字，不能把字符串类型的值赋给它。</p>
<p>第二行的错误在于自动转换数字精度有损失，Rust 语言不允许精度有损失的自动数据类型转换。</p>
<p>第三行的错误在于 a 不是个可变变量。</p>
<p>前两种错误很容易理解，但第三个是什么意思？难道 a 不是个变量吗？</p>
<p>这就牵扯到了 Rust 语言为了高并发安全而做的设计：在语言层面尽量少的让变量的值可以改变。所以 a 的值不可变。但这不意味着 a 不是”变量”（英文中的 variable），官方文档称 a 这种变量为”不可变变量”。</p>
<p>如果我们编写的程序的一部分在假设值永远不会改变的情况下运行，而我们代码的另一部分在改变该值，那么代码的第一部分可能就不会按照设计的意图去运转。由于这种原因造成的错误很难在事后找到。这是 Rust 语言设计这种机制的原因。</p>
<p>当然，使变量变得”可变”（mutable）只需一个 <strong>mut</strong> 关键字。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">a</span> = <span class="number">123</span>;</span><br><span class="line">a = <span class="number">456</span>;</span><br></pre></td></tr></table></figure>
<p><strong>2</strong></p>
<p>重影</p>
<p>重影的概念与其他面向对象语言里的”重写”（Override）或”重载”（Overload）是不一样的。重影就是刚才讲述的所谓”重新绑定”，之所以加引号就是为了在没有介绍这个概念的时候代替一下概念。</p>
<p><strong>重影就是指变量的名称可以被重新使用的机制</strong></p>
<p><strong>3</strong></p>
<p>Rust的 char 类型大小为 4 个字节，代表 Unicode标量值，这意味着它可以支持中文，日文和韩文字符等非英文字符甚至表情符号和零宽度空格在 Rust 中都是有效的 char 值。</p>
<p>元组是用一对 <strong>( )</strong> 包括的一组数据，可以包含不同种类的数据：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">tup</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line">*<span class="comment">// tup.0 等于 500*</span></span><br><span class="line">*<span class="comment">// tup.1 等于 6.4*</span></span><br><span class="line">*<span class="comment">// tup.2 等于 1*</span></span><br><span class="line"><span class="keyword">let</span> (x, y, z) = tup;</span><br><span class="line">*<span class="comment">// y 等于 6.4*</span></span><br></pre></td></tr></table></figure>
<p>数组用一对 <strong>[ ]</strong> 包括的同类型数据。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">*<span class="comment">// a 是一个长度为 5 的整型数组*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = [<span class="string">&quot;January&quot;</span>, <span class="string">&quot;February&quot;</span>, <span class="string">&quot;March&quot;</span>];</span><br><span class="line">*<span class="comment">// b 是一个长度为 3 的字符串数组*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span>: [<span class="type">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">*<span class="comment">// c 是一个长度为 5 的 i32 数组*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">d</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br><span class="line">*<span class="comment">// 等同于 let d = [3, 3, 3, 3, 3];*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">first</span> = a[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">second</span> = a[<span class="number">1</span>];</span><br><span class="line">*<span class="comment">// 数组访问*</span></span><br><span class="line"></span><br><span class="line">a[<span class="number">0</span>] = <span class="number">123</span>; *<span class="comment">// 错误：数组 a 不可变*</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">4</span>; *<span class="comment">// 正确*</span></span><br></pre></td></tr></table></figure>
<p><strong>4</strong></p>
<p>方法Method和函数Function类似，只不过它是用来操作结构体实例的。</p>
<p>如果你学习过一些面向对象的语言，那你一定很清楚函数一般放在类定义里并在函数中用 this 表示所操作的实例。</p>
<p>Rust 语言不是面向对象的，从它所有权机制的创新可以看出这一点。但是面向对象的珍贵思想可以在 Rust 实现。</p>
<p><strong>结构体方法的第一个参数必须是 &amp;self，不需声明类型，因为 self 不是一种风格而是关键字。</strong></p>
<p>计算一个矩形的面积：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width * <span class="keyword">self</span>.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123; width: <span class="number">30</span>, height: <span class="number">50</span> &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;rect1&#x27;s area is &#123;&#125;&quot;</span>, rect1.<span class="title function_ invoke__">area</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之所以”结构体方法”不叫”结构体函数”是因为”函数”这个名字留给了这种函数：它在 impl 块中却没有 &amp;self 参数。</p>
<p>这种函数不依赖实例，但是使用它需要声明是在哪个 impl 块中的。</p>
<p>例如 <strong>String::from</strong> 函数就是一个”关联函数”。</p>
<h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1><p>rustc编译出的elf保护一般除了canary其他全部开启</p>
<p>且是动态链接</p>
<h2 id="函数调用约定"><a href="#函数调用约定" class="headerlink" title="函数调用约定"></a>函数调用约定</h2><p>还是先拿一个程序举个例子</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (r0, r1, r2, r3, r4, r5, r6, r7, r8, r9, r10, r11, r12) = <span class="title function_ invoke__">test</span>(<span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ret</span> = r0 + r1 + r2 + r3 + r4 + r5 + r6 + r7 + r8 + r9 + r10 + r11 + r12;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, ret);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test</span>(a0: <span class="type">i32</span>, a1: <span class="type">i32</span>, a2: <span class="type">i32</span>, a3: <span class="type">i32</span>, a4: <span class="type">i32</span>, a5: <span class="type">i32</span>, a6: <span class="type">i32</span>, a7: <span class="type">i32</span>, a8: <span class="type">i32</span>, a9: <span class="type">i32</span>, a10: <span class="type">i32</span>, a11: <span class="type">i32</span>, a12: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> (<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">arr</span> = [<span class="number">0</span>; <span class="number">13</span>];</span><br><span class="line">    arr[<span class="number">0</span>] = a0 + <span class="number">31</span>;</span><br><span class="line">    arr[<span class="number">1</span>] = a1 + <span class="number">32</span>;</span><br><span class="line">    arr[<span class="number">2</span>] = a1 + <span class="number">33</span>;</span><br><span class="line">    arr[<span class="number">3</span>] = a1 + <span class="number">34</span>;</span><br><span class="line">    arr[<span class="number">4</span>] = a1 + <span class="number">35</span>;</span><br><span class="line">    arr[<span class="number">5</span>] = a1 + <span class="number">36</span>;</span><br><span class="line">    arr[<span class="number">6</span>] = a0 + <span class="number">37</span>;</span><br><span class="line">    arr[<span class="number">7</span>] = a1 + <span class="number">38</span>;</span><br><span class="line">    arr[<span class="number">8</span>] = a1 + <span class="number">39</span>;</span><br><span class="line">    arr[<span class="number">9</span>] = a1 + <span class="number">40</span>;</span><br><span class="line">    arr[<span class="number">10</span>] = a1 + <span class="number">41</span>;</span><br><span class="line">    arr[<span class="number">11</span>] = a1 + <span class="number">42</span>;</span><br><span class="line">    arr[<span class="number">12</span>] = a1 + <span class="number">43</span>;</span><br><span class="line"></span><br><span class="line">    arr[<span class="number">2</span>] = arr[<span class="number">0</span>] + arr[<span class="number">1</span>];</span><br><span class="line">    arr[<span class="number">4</span>] = arr[<span class="number">2</span>] + arr[<span class="number">3</span>];</span><br><span class="line">    arr[<span class="number">6</span>] = arr[<span class="number">4</span>] + arr[<span class="number">5</span>];</span><br><span class="line">    arr[<span class="number">8</span>] = arr[<span class="number">6</span>] + arr[<span class="number">7</span>];</span><br><span class="line">    arr[<span class="number">10</span>] = arr[<span class="number">8</span>] + arr[<span class="number">9</span>];</span><br><span class="line">    arr[<span class="number">12</span>] = arr[<span class="number">10</span>] + arr[<span class="number">11</span>];</span><br><span class="line"></span><br><span class="line">    arr[<span class="number">1</span>] = arr[<span class="number">1</span>] * <span class="number">3</span>;</span><br><span class="line">    arr[<span class="number">1</span>] = arr[<span class="number">1</span>] + <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">    (arr[<span class="number">0</span>], arr[<span class="number">1</span>], arr[<span class="number">2</span>], arr[<span class="number">3</span>], arr[<span class="number">4</span>], arr[<span class="number">5</span>], arr[<span class="number">6</span>], arr[<span class="number">7</span>], arr[<span class="number">8</span>], arr[<span class="number">9</span>], arr[<span class="number">10</span>], arr[<span class="number">11</span>], arr[<span class="number">12</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后ida打开分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000008AF0 48 81 EC 28 01 00 00          sub     rsp, 128h</span><br><span class="line">.text:0000000000008AF7 48 8D BC 24 A0 00 00 00       lea     rdi, [rsp+128h+var_88]</span><br><span class="line">.text:0000000000008AFF BE 47 00 00 00                mov     esi, 47h ; &#x27;G&#x27;</span><br><span class="line">.text:0000000000008B04 BA 48 00 00 00                mov     edx, 48h ; &#x27;H&#x27;</span><br><span class="line">.text:0000000000008B09 B9 49 00 00 00                mov     ecx, 49h ; &#x27;I&#x27;</span><br><span class="line">.text:0000000000008B0E 41 B8 4A 00 00 00             mov     r8d, 4Ah ; &#x27;J&#x27;</span><br><span class="line">.text:0000000000008B14 41 B9 4B 00 00 00             mov     r9d, 4Bh ; &#x27;K&#x27;</span><br><span class="line">.text:0000000000008B1A C7 04 24 4C 00 00 00          mov     [rsp+128h+var_128], 4Ch ; &#x27;L&#x27;</span><br><span class="line">.text:0000000000008B21 C7 44 24 08 4D 00 00 00       mov     [rsp+128h+var_120], 4Dh ; &#x27;M&#x27;</span><br><span class="line">.text:0000000000008B29 C7 44 24 10 4E 00 00 00       mov     [rsp+128h+var_118], 4Eh ; &#x27;N&#x27;</span><br><span class="line">.text:0000000000008B31 C7 44 24 18 4F 00 00 00       mov     [rsp+128h+var_110], 4Fh ; &#x27;O&#x27;</span><br><span class="line">.text:0000000000008B39 C7 44 24 20 50 00 00 00       mov     [rsp+128h+var_108], 50h ; &#x27;P&#x27;</span><br><span class="line">.text:0000000000008B41 C7 44 24 28 51 00 00 00       mov     [rsp+128h+var_100], 51h ; &#x27;Q&#x27;</span><br><span class="line">.text:0000000000008B49 C7 44 24 30 52 00 00 00       mov     [rsp+128h+var_F8], 52h ; &#x27;R&#x27;</span><br><span class="line">.text:0000000000008B51 C7 44 24 38 53 00 00 00       mov     [rsp+128h+var_F0], 53h ; &#x27;S&#x27;</span><br><span class="line">.text:0000000000008B59 E8 C2 03 00 00                call    _ZN4args4test17hfe78a747667e0fd0E ; args::test::hfe78a747667e0fd0</span><br></pre></td></tr></table></figure>
<ul>
<li>rust前六个参数分别使用di,si,dx,cx,r8,r9,剩余参数由栈传递,从右到左入栈,与c语言差别不大</li>
<li>局部变量使用sp寄存器传递而非bp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000008B59</span><br><span class="line">.text:0000000000008B5E 8B 84 24 A0 00 00 00          mov     eax, [rsp+128h+var_88]</span><br><span class="line">.text:0000000000008B65 8B 8C 24 A4 00 00 00          mov     ecx, [rsp+128h+var_84]</span><br><span class="line">.text:0000000000008B6C 8B 94 24 A8 00 00 00          mov     edx, [rsp+128h+var_80]</span><br><span class="line">.text:0000000000008B73 89 54 24 70                   mov     [rsp+128h+var_B8], edx</span><br><span class="line">.text:0000000000008B77 8B 94 24 AC 00 00 00          mov     edx, [rsp+128h+var_7C]</span><br><span class="line">.text:0000000000008B7E 89 54 24 74                   mov     [rsp+128h+var_B4], edx</span><br><span class="line">.text:0000000000008B82 8B 94 24 B0 00 00 00          mov     edx, [rsp+128h+var_78]</span><br><span class="line">.text:0000000000008B89 89 54 24 78                   mov     [rsp+128h+var_B0], edx</span><br><span class="line">.text:0000000000008B8D 8B 94 24 B4 00 00 00          mov     edx, [rsp+128h+var_74]</span><br><span class="line">.text:0000000000008B94 89 54 24 7C                   mov     [rsp+128h+var_AC], edx</span><br><span class="line">.text:0000000000008B98 8B 94 24 B8 00 00 00          mov     edx, [rsp+128h+var_70]</span><br><span class="line">.text:0000000000008B9F 89 94 24 80 00 00 00          mov     [rsp+128h+var_A8], edx</span><br><span class="line">.text:0000000000008BA6 8B 94 24 BC 00 00 00          mov     edx, [rsp+128h+var_6C]</span><br><span class="line">.text:0000000000008BAD 89 94 24 84 00 00 00          mov     [rsp+128h+var_A4], edx</span><br><span class="line">.text:0000000000008BB4 8B 94 24 C0 00 00 00          mov     edx, [rsp+128h+var_68]</span><br><span class="line">.text:0000000000008BBB 89 94 24 88 00 00 00          mov     [rsp+128h+var_A0], edx</span><br><span class="line">.text:0000000000008BC2 8B 94 24 C4 00 00 00          mov     edx, [rsp+128h+var_64]</span><br><span class="line">.text:0000000000008BC9 89 94 24 8C 00 00 00          mov     [rsp+128h+var_9C], edx</span><br><span class="line">.text:0000000000008BD0 8B 94 24 C8 00 00 00          mov     edx, [rsp+128h+var_60]</span><br><span class="line">.text:0000000000008BD7 89 94 24 90 00 00 00          mov     [rsp+128h+var_98], edx</span><br><span class="line">.text:0000000000008BDE 8B 94 24 CC 00 00 00          mov     edx, [rsp+128h+var_5C]</span><br><span class="line">.text:0000000000008BE5 89 94 24 94 00 00 00          mov     [rsp+128h+var_94], edx</span><br><span class="line">.text:0000000000008BEC 8B 94 24 D0 00 00 00          mov     edx, [rsp+128h+var_58]</span><br><span class="line">.text:0000000000008BF3 89 94 24 98 00 00 00          mov     [rsp+128h+var_90], edx</span><br></pre></td></tr></table></figure>
<ul>
<li>返回值可能通过寄存器也可能会通过栈传递</li>
</ul>
<h2 id="RustReverse"><a href="#RustReverse" class="headerlink" title="RustReverse"></a>RustReverse</h2><p>rust编译后的代码阅读难度可以说是诸多语言中最难的那一挂了</p>
<h3 id="函数命名方式"><a href="#函数命名方式" class="headerlink" title="函数命名方式"></a>函数命名方式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000009510                               ; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">.text:0000000000009510                               public main</span><br><span class="line">.text:0000000000009510                               main proc near                          ; DATA XREF: _start+21↑o</span><br><span class="line">.text:0000000000009510                               ; __unwind &#123;</span><br><span class="line">.text:0000000000009510 50                            push    rax</span><br><span class="line">.text:0000000000009511 48 89 F2                      mov     rdx, rsi</span><br><span class="line">.text:0000000000009514 48 63 F7                      movsxd  rsi, edi</span><br><span class="line">.text:0000000000009517 48 8D 3D D2 F5 FF FF          lea     rdi, _ZN4args4main17h75bfffcee5664dbbE ; args::main::h75bfffcee5664dbb</span><br><span class="line">.text:000000000000951E 31 C9                         xor     ecx, ecx</span><br><span class="line">.text:0000000000009520 E8 EB F3 FF FF                call    _ZN3std2rt10lang_start17h6bb08cda28f5c966E ; std::rt::lang_start::h6bb08cda28f5c966</span><br><span class="line">.text:0000000000009520</span><br><span class="line">.text:0000000000009525 59                            pop     rcx</span><br><span class="line">.text:0000000000009526 C3                            retn</span><br><span class="line">.text:0000000000009526                               ; &#125; // starts at 9510</span><br><span class="line">.text:0000000000009526</span><br><span class="line">.text:0000000000009526                               main endp</span><br></pre></td></tr></table></figure>
<p>我们在ida中找到的名为main的函数其实并不是真正的主函数</p>
<p><code>_ZN4args4main17h75bfffcee5664dbbE</code>才是,这个命名规则与C++特别相似</p>
<ul>
<li><code>_ZN</code>是固定开头</li>
<li>第一个<code>4</code>代表下一模块的长度,在这里是源文件的名字<code>args</code></li>
<li>第二个<code>4</code>代表代表源代码中函数名的长度,<code>main</code></li>
<li><code>17h</code>同样是固定的,后接17位哈希值</li>
</ul>
<p>这种命名方法叫做<code>name mangling</code>,还可以在这基础之上套更多层,例如<code>_ZN3std2io5stdio5stdin17h821c04443a399516E</code></p>
<h3 id="基础语法分析"><a href="#基础语法分析" class="headerlink" title="基础语法分析"></a>基础语法分析</h3><p>以如下代码为例</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span>: <span class="type">String</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    io::<span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> input).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Read Error!&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = input.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Input not a number!&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="keyword">match</span> num &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="string">&quot;one&quot;</span>,</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="string">&quot;two&quot;</span>,</span><br><span class="line">        x <span class="keyword">if</span> x &lt; <span class="number">10</span> =&gt; <span class="string">&quot;Something smaller than 10&quot;</span>,</span><br><span class="line">        _ =&gt; <span class="string">&quot;Something not smaller than 10&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>line1</strong></p>
<p>第一行定义了一个字符串变量，使用<code>String::new()</code>方法。但是在汇编中可以发现，<code>call</code>调用<code>String::new()</code>函数并没有对返回值进行操作，而是将<code>rdi</code>进行了赋值，这与C语言不同，如果按照C语言的逻辑，则更像是<code>String::new(&amp;input)</code>。随后，笔者修改了代码进行试验，发现<code>Vec</code>的<code>new</code>方法流程类似。可见各个对象的<code>new</code>方法实际上是传了参的。</p>
<p>后面可以看到rdi就是string对象的地址</p>
<p><strong>line 2</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000000A570                               ; __unwind &#123; // std__sys__personality__gcc__rust_eh_personality</span><br><span class="line">.text:000000000000A570 48 81 EC 08 01 00 00          sub     rsp, 108h</span><br><span class="line">.text:000000000000A577 48 8D 7C 24 50                lea     rdi, [rsp+108h+var_B8]</span><br><span class="line">.text:000000000000A57C E8 7F F8 FF FF                call    _ZN5alloc6string6String3new17h5e8310b784223365E ; alloc::string::String::new::h5e8310b784223365</span><br><span class="line">.text:000000000000A57C</span><br><span class="line">.text:000000000000A581 48 8D 05 78 89 01 00          lea     rax, _ZN3std2io5stdio5stdin17h821c04443a399516E ; std::io::stdio::stdin::h821c04443a399516</span><br><span class="line">.text:000000000000A588 FF D0                         call    rax ; std::io::stdio::stdin::h821c04443a399516 ; std::io::stdio::stdin::h821c04443a399516</span><br><span class="line">.text:000000000000A588</span><br><span class="line">.text:000000000000A58A 48 89 44 24 48                mov     [rsp+108h+var_C0], rax</span><br><span class="line">.text:000000000000A58F EB 25                         jmp     short loc_A5B6</span><br><span class="line">.text:000000000000A58F</span><br><span class="line">.text:000000000000A591                               ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000000000000A591</span><br><span class="line">.text:000000000000A591                               loc_A591:                               ; CODE XREF: test::main::h2ce2d64a768297ee+44↓j</span><br><span class="line">.text:000000000000A591 48 8D 7C 24 50                lea     rdi, [rsp+arg_48]</span><br><span class="line">.text:000000000000A596 E8 F5 EF FF FF                call    _ZN4core3ptr42drop_in_place$LT$alloc__string__String$GT$17h78fd65dd1ea29097E ; core::ptr::drop_in_place$LT$alloc..string..String$GT$::h78fd65dd1ea29097</span><br><span class="line">.text:000000000000A596</span><br><span class="line">.text:000000000000A59B E9 3B 02 00 00                jmp     loc_A7DB</span><br><span class="line">.text:000000000000A59B</span><br><span class="line">.text:000000000000A5A0                               ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000000000000A5A0 48 89 C1                      mov     rcx, rax</span><br><span class="line">.text:000000000000A5A3 89 D0                         mov     eax, edx</span><br><span class="line">.text:000000000000A5A5 48 89 8C 24 E0 00 00 00       mov     [rsp+arg_D8], rcx</span><br><span class="line">.text:000000000000A5AD 89 84 24 E8 00 00 00          mov     [rsp+arg_E0], eax</span><br><span class="line">.text:000000000000A5B4 EB DB                         jmp     short loc_A591</span><br><span class="line">.text:000000000000A5B4</span><br><span class="line">.text:000000000000A5B6                               ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000000000000A5B6</span><br><span class="line">.text:000000000000A5B6                               loc_A5B6:                               ; CODE XREF: test::main::h2ce2d64a768297ee+1F↑j</span><br><span class="line">.text:000000000000A5B6 48 8B 44 24 48                mov     rax, [rsp+108h+var_C0]</span><br><span class="line">.text:000000000000A5BB 48 89 44 24 78                mov     [rsp+108h+var_90], rax</span><br><span class="line">.text:000000000000A5C0 48 8D 05 69 89 01 00          lea     rax, _ZN3std2io5stdio5Stdin9read_line17h75874c24c55eccd0E ; std::io::stdio::Stdin::read_line::h75874c24c55eccd0</span><br><span class="line">.text:000000000000A5C7 48 8D 7C 24 68                lea     rdi, [rsp+108h+var_A0]</span><br><span class="line">.text:000000000000A5CC 48 8D 74 24 78                lea     rsi, [rsp+108h+var_90]</span><br><span class="line">.text:000000000000A5D1 48 8D 54 24 50                lea     rdx, [rsp+108h+var_B8]</span><br><span class="line">.text:000000000000A5D6 FF D0                         call    rax ; std::io::stdio::Stdin::read_line::h75874c24c55eccd0 ; std::io::stdio::Stdin::read_line::h75874c24c55eccd0</span><br></pre></td></tr></table></figure>
<p>由于<code>io::stdin()</code>返回的是<code>Stdin</code>，代码中使用的返回值与C语言一样，保存在<code>rax</code>中。不过这里是首先将函数地址赋值给<code>rax</code>，通过<code>call rax</code>完成调用。</p>
<p>调用完<code>stdin()</code>后，Rust不知道为什么用了一个<code>jmp</code>指令，跨越了几条指令再继续执行后面的<code>read_line</code>方法。对于<code>read_line</code>方法，可以看到前3个寄存器进行了赋值。其中<code>rsi</code>是<code>io::stdin()</code>的返回值，也就是<code>Stdin</code>对象实例，<code>rdx</code>则是输入的字符串的地址，这一点可以通过第一行对<code>[rsp+80]</code>赋值得知，那么<code>rdi</code>是什么呢？这里就需要返回到IDA界面查看。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/2024-03-10_161620.png" alt=""></p>
<p>IDA将第一个参数解析为self，类型为core::result::Result<usize,std::io::error::Error>，而这个是read_line函数的返回值。这与io::stdin()不同，也是没有将返回值保存到rax。</p>
<p>随后，代码继续向下，继续调用了expect方法，传入的第一个参数就是Result实例，第二个参数是我们设置的错误字符串Read Error!地址，第三个参数为11，推测是错误字符串的长度，第四个参数通过查看发现，是这段汇编代码对应的源代码在工程中的路径。由此我们可以发现，如果今后我们需要分析一个不带符号的Rust ELF，发现有一个函数有4个参数，其中第2、4个参数均为字符串，且第4个参数是源文件地址、第3个参数是第2个参数字符串的长度，那么这个函数很有可能就是expect，通过跟踪第一个参数Result对象，可以继续进行分析。</p>
<p>汇编代码看到这里，我们能够发现，即使代码顺序执行，Rust编译器也一定要在一个函数调用结束后插入一个jmp指令，这一点可以从调用read_line方法可以得知，向下不断滑动窗口也能发现，整个main函数似乎是被许多jmp指令划分为许多小部分。</p>
<p><strong>line 3</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/2024-03-10_162236.png" alt=""></p>
<p>第三行首先看到，代码中使用了<code>deref</code>这个方法</p>
<blockquote>
<p>在Rust中，<code>Deref</code>是一个trait（特性），它允许你重载解引用运算符<code>*</code>。它的作用是允许你间接引用（indirectly reference）类型的值，使得在代码中使用起来更加方便。</p>
<p>当你实现了<code>Deref</code> trait，你告诉编译器在某些情况下，当你对某个类型的引用或者智能指针使用<code>*</code>运算符时，应该怎样处理。具体来说，当你对一个实现了<code>Deref</code> trait的类型进行解引用时，编译器会自动调用<code>deref</code>方法，这个方法返回一个引用，然后解引用操作继续应用到这个引用上。</p>
<p>这个功能对于编写泛型代码和操作智能指针（如<code>Box</code>、<code>Rc</code>、<code>Arc</code>等）非常有用。例如，如果你有一个<code>Box&lt;T&gt;</code>类型的值，而你想要直接调用<code>T</code>类型的方法，你可以通过实现<code>Deref</code> trait 来实现自动解引用，使得在使用<code>*</code>运算符时，可以像操作<code>T</code>类型一样操作<code>Box&lt;T&gt;</code>。</p>
<p>简而言之，<code>Deref</code> trait的作用是允许你通过实现解引用操作符<code>*</code>的行为，使得类型的引用或者智能指针的使用更加方便和灵活。</p>
</blockquote>
<p>至于为什么使用这个方法其实很好理解。<code>deref</code>传入的是<code>String</code>实例，返回的是字符串切片<code>&amp;str</code>，而<code>trim</code>方法实际上是以切片作为<code>self</code>的，因此这里Rust隐式地将<code>String</code>转成切片之后再执行<code>trim</code>。</p>
<p>调用<code>deref</code>方法后需要注意，这里将<code>rdx</code>和<code>rax</code>保存到了栈中。字符串切片的时候字符串切片实际上由两个部分组成——指针与长度。</p>
<p><code>rdx</code>保存的是长度，<code>rax</code>保存的是字符串指针。因此我们知道了，<strong><code>String</code>类型的<code>deref</code>方法会将返回值保存在两个寄存器——<code>rdx</code>与<code>rax</code>中。</strong></p>
<p>随后就是<code>trim</code>方法的调用，传入的第1个参数是字符串指针，第2个参数是长度。其返回值依然是保存在两个寄存器中。可见对于返回值为<code>&amp;str</code>的Rust方法，其返回的方式也有一定规律。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/2024-03-10_174110.png" alt=""></p>
<p><code>trim</code>之后是<code>parse</code>，返回值是<code>Result</code>类型，和<code>read_line</code>不同的是，<code>read_line</code>返回的<code>Result</code>实例没有泛型（<code>Result&lt;usize&gt;</code>），但是<code>parse</code>的返回值是<code>Result&lt;F, F::Err&gt;</code>，可能是这个原因，导致<code>read_line</code>可以将<code>Result</code>指针直接作为参数传递，而<code>parse</code>只能通过<code>rax</code>返回。不过目前这只是猜测</p>
<p><code>expect</code>是需要将返回值保存在<code>num</code>中的，也就是<code>mov dword ptr [rsp + 28], eax</code>这条语句，可见<code>num</code>是保存在<code>[rsp+0x28]</code>的位置。</p>
<p><strong>line 4~9</strong></p>
<p>下面的几行是一个<code>println!</code>一个<code>match</code>语句的值。在学Rust的时候我们了解到，<code>match</code>语句可以实现类似于lambda函数的功能，每一个分支的<code>=&gt;</code>后都可以看成这个条件下<code>match</code>的返回值。就如这几行是将<code>match</code>的每一个分支语句都定义一个字符串切片作为传入<code>println!</code>的格式化参数。</p>
<p>首先处理返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000000A683                               loc_A683:                               ; CODE XREF: test::main::h2ce2d64a768297ee+111↑j</span><br><span class="line">.text:000000000000A683 8B 44 24 1C                   mov     eax, [rsp+108h+var_EC]</span><br><span class="line">.text:000000000000A687 89 84 24 84 00 00 00          mov     [rsp+108h+var_84], eax</span><br><span class="line">.text:000000000000A68E 8B 84 24 84 00 00 00          mov     eax, [rsp+108h+var_84]</span><br><span class="line">.text:000000000000A695 89 44 24 18                   mov     [rsp+108h+var_F0], eax</span><br><span class="line">.text:000000000000A699 83 E8 01                      sub     eax, 1</span><br><span class="line">.text:000000000000A69C 74 1D                         jz      short loc_A6BB</span><br></pre></td></tr></table></figure>
<p>在汇编代码中，<code>println!</code>的处理流程可能不是都在所有<code>match</code>流程之后，而是在中间插入了一段，随后又在跳转到后面</p>
<p><code>println!</code>的宏展开部分，考虑到<code>println!</code>太常见，通过IDA的反汇编输出的源代码可以识别出其特征。可以看到在汇编中调用了<code>core::fmt::ArgumentV1::new_display</code>、<code>core::fmt::Arguments::new_v1</code>、<code>std::io::stdio::_print</code>这三个方法。其中前面两个推测是Rust宏的转换函数，也就是将宏中大括号部分替换为具体的参数，而最后一个方法则是输出内容到控制台。</p>
<p><code>core::fmt::ArgumentV1::new_display</code>这个函数是用来解析<code>println!</code>后面的参数的，将其转换为字符串切片，有几个大括号就需要调用几次。</p>
<p>这样看来，这里的含义也就清楚了。编译器在对宏进行展开时转义大括号的内容是这样操作的：</p>
<ul>
<li>首先将含有大括号的字符串以大括号分隔，并形成上面的这个数组结构。</li>
<li>对于每一个大括号，都调用一次转义函数进行转义，在栈中形成一个<code>&amp;str</code>的数组。</li>
<li>随后再调用另外一个函数（<code>core::fmt::Arguments::new_v1</code>）将这些切片拼起来组成最终的字符串。</li>
</ul>
<p><code>core::fmt::Arguments::new_v1</code>的5个参数含义分别就是：</p>
<ul>
<li><code>rdi</code>：输出字符串指针</li>
<li><code>rsi</code>：预编译的数组结构，表示宏不需要转义的字符串部分</li>
<li><code>rdx</code>：预编译数组结构的长度</li>
<li><code>rcx</code>：运行时解析的已经被转义的<code>&amp;str</code>数组</li>
<li><code>r8</code>：运行时解析的<code>&amp;str</code>数组长度</li>
</ul>
<p>这个函数调用完之后，就可以进行宏展开的后续代码了。对于<code>println!</code>而言是输出，也即调用<code>std::io::stdio::_print</code>。</p>
<p>在之后的<code>core::ptr::drop_in_place</code>应该是Rust将这个<code>String</code>对象实例回收了</p>
<h2 id="ida反汇编"><a href="#ida反汇编" class="headerlink" title="ida反汇编"></a>ida反汇编</h2><p>在反汇编的输出结果中，出现了比较奇怪的地方。</p>
<p>最为明显的就是字符串的解析。通过查看ELF中保存字符串的地方可以发现，Rust的字符串与字符串之间有的是以换行符隔开的，有的根本就没有分割的字符，这与C/C++使用0字符分割每个字符串不同。因为Rust字符串切片的特性，对一个字符串切片的操作必然需要使用到这个切片的长度。既然已经知道了字符串的长度，字符串与字符串之间的分隔就显得没有那么必要了。</p>
<p>不过庆幸的是，反汇编中对于main函数的主要逻辑的解析还是比较清楚的，第一行的<code>String::new()</code>表示创建了一个<code>String</code>实例，随后多个函数的调用连在一起就组成了第二行的读取字符串内容，就是<code>expect</code>函数的解析看上去不是很舒服，毕竟其与C/C++的函数调用规则有些许不同。</p>
<p>再往下，可以看到<code>deref</code>、<code>trim</code>、<code>parse</code>、<code>expect</code>，这些函数组成了第三行的内容。</p>
<p>对于接下来的<code>match</code>，在反汇编界面中是将其解析成了多个<code>if-else</code>语句。随后就是<code>println!</code>的宏展开，输出字符串。输出后通过<code>drop_in_place</code>删除了一开始创建的<code>String</code>实例，函数返回。</p>
<h2 id="hfctf2022-vdq"><a href="#hfctf2022-vdq" class="headerlink" title="hfctf2022-vdq"></a>hfctf2022-vdq</h2><p>ida打开静态分析,显然分析不动,反编译出来的代码有点哈人了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// local variable allocation has failed, the output may be wrong!</span></span><br><span class="line">alloc::vec::Vec&lt;vdq::Operation&gt; *__cdecl vdq::get_opr_lst::h470c4d46db5f8252(alloc::vec::Vec&lt;vdq::Operation&gt; *retstr)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="built_in">std</span>::io::Lines&lt;<span class="built_in">std</span>::io::stdio::StdinLock&gt; *v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="built_in">std</span>::io::Lines&lt;<span class="built_in">std</span>::io::stdio::StdinLock&gt; *v3; <span class="comment">// rdi</span></span><br><span class="line">  <span class="built_in">std</span>::sync::mutex::Mutex&lt;<span class="built_in">std</span>::io::buffered::BufReader&lt;<span class="built_in">std</span>::io::stdio::StdinRaw&gt;&gt; *v4; <span class="comment">// rax</span></span><br><span class="line">  _str v5; <span class="comment">// rdi</span></span><br><span class="line">  _str *v6; <span class="comment">// rax</span></span><br><span class="line">  alloc::<span class="built_in">string</span>::String *v7; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">const</span> u8 *v8; <span class="comment">// rdx OVERLAPPED</span></span><br><span class="line">  __int64 v9; <span class="comment">// rcx OVERLAPPED</span></span><br><span class="line">  _str *v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rdx</span></span><br><span class="line">  _str v12; <span class="comment">// rax</span></span><br><span class="line">  __m256i s; <span class="comment">// [rsp+0h] [rbp-1C8h]</span></span><br><span class="line">  alloc::<span class="built_in">string</span>::String *v15; <span class="comment">// [rsp+30h] [rbp-198h]</span></span><br><span class="line">  alloc::<span class="built_in">string</span>::String v18; <span class="comment">// [rsp+80h] [rbp-148h] BYREF</span></span><br><span class="line">  __int64 v19; <span class="comment">// [rsp+98h] [rbp-130h]</span></span><br><span class="line">  <span class="built_in">std</span>::io::Lines&lt;<span class="built_in">std</span>::io::stdio::StdinLock&gt; v20; <span class="comment">// [rsp+A0h] [rbp-128h] BYREF</span></span><br><span class="line">  core::option::Option&lt;core::result::Result&lt;alloc::<span class="built_in">string</span>::String,<span class="built_in">std</span>::io::error::Error&gt;&gt; v21; <span class="comment">// [rsp+B0h] [rbp-118h]</span></span><br><span class="line">  core::option::Option&lt;core::result::Result&lt;alloc::<span class="built_in">string</span>::String,<span class="built_in">std</span>::io::error::Error&gt;&gt; v22; <span class="comment">// [rsp+D0h] [rbp-F8h] BYREF</span></span><br><span class="line">  core::option::Option&lt;core::result::Result&lt;alloc::<span class="built_in">string</span>::String,<span class="built_in">std</span>::io::error::Error&gt;&gt; v23; <span class="comment">// [rsp+F0h] [rbp-D8h]</span></span><br><span class="line">  core::option::Option&lt;core::result::Result&lt;alloc::<span class="built_in">string</span>::String,<span class="built_in">std</span>::io::error::Error&gt;&gt; v24; <span class="comment">// [rsp+110h] [rbp-B8h]</span></span><br><span class="line">  core::option::Option&lt;core::result::Result&lt;alloc::<span class="built_in">string</span>::String,<span class="built_in">std</span>::io::error::Error&gt;&gt; v25; <span class="comment">// [rsp+130h] [rbp-98h]</span></span><br><span class="line">  alloc::<span class="built_in">string</span>::String v26; <span class="comment">// [rsp+158h] [rbp-70h] BYREF</span></span><br><span class="line">  _str msg; <span class="comment">// [rsp+170h] [rbp-58h] BYREF</span></span><br><span class="line">  __int128 v28; <span class="comment">// [rsp+180h] [rbp-48h]</span></span><br><span class="line">  core::result::Result&lt;alloc::vec::Vec&lt;vdq::Operation&gt;,serde_json::error::Error&gt; v29; <span class="comment">// [rsp+190h] [rbp-38h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v30; <span class="comment">// [rsp+1B7h] [rbp-11h]</span></span><br><span class="line">  <span class="built_in">std</span>::io::stdio::StdinLock buf; <span class="comment">// 0:rsi.8,8:dl.1 OVERLAPPED</span></span><br><span class="line"></span><br><span class="line">  v30 = <span class="number">0</span>;</span><br><span class="line">  alloc::<span class="built_in">string</span>::String::new::h29015bd483c39e5e(&amp;v18);</span><br><span class="line">  <span class="built_in">std</span>::io::stdio::<span class="built_in">stdin</span>::h57f01e412024e542();</span><br><span class="line">  v19 = v1;</span><br><span class="line">  <span class="built_in">std</span>::io::stdio::Stdin::lock::hf73a34e132524cb0();</span><br><span class="line">  buf.inner.lock = (<span class="built_in">std</span>::sync::mutex::Mutex&lt;<span class="built_in">std</span>::io::buffered::BufReader&lt;<span class="built_in">std</span>::io::stdio::StdinRaw&gt;&gt; *)buf.inner.poison.panicking;</span><br><span class="line">  v3 = <span class="built_in">std</span>::io::BufRead::lines::h86548d68a94a059d(v2, buf);</span><br><span class="line">  LOBYTE(buf.inner.lock) = buf.inner.poison.panicking;</span><br><span class="line">  buf = _$LT$I$u20$as$u20$core..iter..traits..collect..IntoIterator$GT$::into_iter::hbd4fdd057b02a75e((<span class="built_in">std</span>::io::Lines&lt;<span class="built_in">std</span>::io::stdio::StdinLock&gt;)buf).buf;</span><br><span class="line">  v20.buf.inner.lock = v4;</span><br><span class="line">  v20.buf.inner.poison.panicking = buf.inner.poison.panicking;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    _$LT$<span class="built_in">std</span>..io..Lines$LT$B$GT$$u20$as$u20$core..iter..traits..iterator..Iterator$GT$::next::h301be3b59ffffa3b(</span><br><span class="line">      &amp;v22,</span><br><span class="line">      &amp;v20);</span><br><span class="line">    v5.length = *(_QWORD *)v22.gap0 != <span class="number">2LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *(_QWORD *)v22.gap0 == <span class="number">2LL</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v23 = v22;</span><br><span class="line">    v24 = v22;</span><br><span class="line">    v21 = v22;</span><br><span class="line">    v30 = <span class="number">0</span>;</span><br><span class="line">    v25 = v22;</span><br><span class="line">    v28 = *(_OWORD *)&amp;v22.gap0[<span class="number">16</span>];</span><br><span class="line">    msg = *(_str *)v22.gap0;</span><br><span class="line">    core::result::Result$LT$T$C$E$GT$::expect::h1c4a511674846791(</span><br><span class="line">      &amp;v26,</span><br><span class="line">      (core::result::Result&lt;alloc::<span class="built_in">string</span>::String,<span class="built_in">std</span>::io::error::Error&gt;)s,</span><br><span class="line">      (_str)__PAIR128__(&amp;unk_624C8, &amp;msg));</span><br><span class="line">    v6 = _$LT$alloc..<span class="built_in">string</span>..String$u20$as$u20$core..ops..deref..Deref$GT$::deref::h35d0b02de411ef97(</span><br><span class="line">           (_str *)&amp;v26,</span><br><span class="line">           (alloc::<span class="built_in">string</span>::String *)&amp;msg);</span><br><span class="line">    v15 = v7;</span><br><span class="line">    v8 = <span class="string">&quot;$Cached notes:\nArchive note []\nAppend with message : \nRemoved note [&quot;</span>;</span><br><span class="line">    v9 = <span class="number">1LL</span>;</span><br><span class="line">    v5.data_ptr = (u8 *)v6;</span><br><span class="line">    v5.length = (usize)v15;</span><br><span class="line">    <span class="keyword">if</span> ( core::str::_$LT$impl$u20$str$GT$::starts_with::he12bd255c6661204(v5, *(_str *)&amp;v8) )</span><br><span class="line">    &#123;</span><br><span class="line">      core::ptr::drop_in_place::h651d4c9afc9ff69a(&amp;v26);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v10 = _$LT$alloc..<span class="built_in">string</span>..String$u20$as$u20$core..ops..deref..Deref$GT$::deref::h35d0b02de411ef97((_str *)&amp;v26, v15);</span><br><span class="line">    s.m256i_i64[<span class="number">3</span>] = v11;</span><br><span class="line">    s.m256i_i64[<span class="number">2</span>] = (__int64)v10;</span><br><span class="line">    _$LT$alloc..<span class="built_in">string</span>..String$u20$as$u20$core..ops..arith..AddAssign$LT$$RF$str$GT$$GT$::add_assign::h9ddd8743286d6398(</span><br><span class="line">      &amp;v18,</span><br><span class="line">      *(_str *)&amp;s.m256i_u64[<span class="number">2</span>]);</span><br><span class="line">    core::ptr::drop_in_place::h651d4c9afc9ff69a(&amp;v26);</span><br><span class="line">    v30 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v30 = <span class="number">0</span>;</span><br><span class="line">  core::ptr::drop_in_place::h6802554197a3e532(&amp;v20);</span><br><span class="line">  v12.data_ptr = (u8 *)_$LT$alloc..<span class="built_in">string</span>..String$u20$as$u20$core..ops..deref..Deref$GT$::deref::h35d0b02de411ef97(</span><br><span class="line">                         (_str *)&amp;v18,</span><br><span class="line">                         (alloc::<span class="built_in">string</span>::String *)v5.length);</span><br><span class="line">  *(_str *)s.m256i_i8 = v12;</span><br><span class="line">  serde_json::de::from_str::h2ed086b1a84205ca(&amp;v29, v12);</span><br><span class="line">  core::result::Result$LT$T$C$E$GT$::expect::h3d3eae349eafbd4b(</span><br><span class="line">    retstr,</span><br><span class="line">    (core::result::Result&lt;alloc::vec::Vec&lt;vdq::Operation&gt;,serde_json::error::Error&gt;)s,</span><br><span class="line">    (_str)__PAIR128__(&amp;unk_624E0, &amp;v29));</span><br><span class="line">  core::ptr::drop_in_place::h651d4c9afc9ff69a(&amp;v18);</span><br><span class="line">  <span class="keyword">return</span> retstr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有点难绷,怎么输入都不知道,再沉淀一下</p>
</div></div><div class="aside-content" id="aside-content"><div class="card-widget card-author"><div class="item-headline"><i class="fa-solid fa-circle-user"></i><span>Author</span></div><div class="author-main-content"><div class="author-check-content"><label class="author-info" for="author-info">     <input id="author-info" type="checkbox" name="author-info"/><div class="author-avatar"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-name">ixout</div></label></div><div class="author-switch-content"><input class="switch-content" type="radio" name="switch-content" value="description"/><label class="author-description-box">      <div class="author-description"><font color="#e66b6d">十八线业余选手</font></div></label><input class="switch-content" type="radio" name="switch-content" value="social" checked="checked"/><label class="author-social-box"><a class="card-author-button" target="_blank" rel="noopener" href="https://github.com/ixout"><i class="iconfont icon-github"></i><span>Follow Me With Github</span></a><div class="social-icons"><a class="social-icon" href="https://github.com/ixout" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="/1425430423" target="_blank" title="QQ"><i class="fa-brands fa-qq"></i></a></div></label><input class="switch-content" type="radio" name="switch-content" value="site-data"/><label class="author-data-box"><div class="site-data"><a class="data-item" href="/archives/"><div class="data-name">文章</div><div class="data-length">57</div></a><a class="data-item" href="/tags/"><div class="data-name">标签</div><div class="data-length">64</div></a><a class="data-item" href="/categories/"><div class="data-name">分类</div><div class="data-length">5</div></a></div></label></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>告示牌</span></div><div class="announcement_content"><font color="＃00CED1">(º﹃º)阿巴阿巴阿巴......</font></div></div><div class="card-widget" id="card-poem"><div id="poem_sentence"></div><div id="poem_info"><div id="poem_dynasty"></div><div id="poem_author"></div></div></div><script src="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/jinrishici.js" charset="utf-8"></script><script type="text/javascript">jinrishici.load(function(result) {
var sentence = document.querySelector("#poem_sentence")
var author = document.querySelector("#poem_author")
var dynasty = document.querySelector("#poem_dynasty")

var sentenceText = result.data.content
sentenceText = sentenceText.substr(0, sentenceText.length - 1);
sentence.innerHTML = sentenceText
dynasty.innerHTML = result.data.origin.dynasty
author.innerHTML = result.data.origin.author + '《' + result.data.origin.title + '》'
});</script><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/22716/" title="2024ciscn华东南pwn"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/a96d6be2655648d9ab6dc8b314f2a8d1%20(1).jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024ciscn华东南pwn"/></a><div class="content"><a class="title" href="/posts/22716/" title="2024ciscn华东南pwn">2024ciscn华东南pwn</a><time datetime="2024-06-24T07:59:49.000Z" title="发表于 2024-06-24 15:59:49">2024-06-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/53981/" title="fuzz-in-pwn"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/a96d6be2655648d9ab6dc8b314f2a8d1%20(1).jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="fuzz-in-pwn"/></a><div class="content"><a class="title" href="/posts/53981/" title="fuzz-in-pwn">fuzz-in-pwn</a><time datetime="2024-05-12T14:29:46.000Z" title="发表于 2024-05-12 22:29:46">2024-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2980/" title="几道iotpwn题目复现"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/ixout/picture@main/img/676eab85f89e48508a.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="几道iotpwn题目复现"/></a><div class="content"><a class="title" href="/posts/2980/" title="几道iotpwn题目复现">几道iotpwn题目复现</a><time datetime="2024-05-12T13:59:00.000Z" title="发表于 2024-05-12 21:59:00">2024-05-12</time></div></div></div></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/pwn/" style="font-size: 1.45em; color: rgb(0, 59, 193)">pwn</a><a href="/tags/dirtypagetable/" style="font-size: 1.15em; color: rgb(122, 103, 25)">dirtypagetable</a><a href="/tags/wp/" style="font-size: 1.3em; color: rgb(90, 56, 136)">wp</a><a href="/tags/IO-FILE/" style="font-size: 1.15em; color: rgb(51, 51, 33)">IO_FILE</a><a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" style="font-size: 1.4em; color: rgb(12, 20, 166)">学习记录</a><a href="/tags/VMpwn/" style="font-size: 1.15em; color: rgb(119, 140, 161)">VMpwn</a><a href="/tags/wasm/" style="font-size: 1.15em; color: rgb(180, 184, 46)">wasm</a><a href="/tags/webpwn/" style="font-size: 1.15em; color: rgb(152, 85, 48)">webpwn</a><a href="/tags/buuctf/" style="font-size: 1.15em; color: rgb(95, 98, 196)">buuctf</a><a href="/tags/calloc/" style="font-size: 1.15em; color: rgb(54, 43, 114)">calloc</a><a href="/tags/realloc/" style="font-size: 1.15em; color: rgb(198, 87, 43)">realloc</a><a href="/tags/grpc/" style="font-size: 1.15em; color: rgb(30, 8, 58)">grpc</a><a href="/tags/protobuf/" style="font-size: 1.2em; color: rgb(152, 100, 113)">protobuf</a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 1.25em; color: rgb(86, 36, 1)">基础</a><a href="/tags/elf/" style="font-size: 1.15em; color: rgb(82, 68, 65)">elf</a><a href="/tags/%E6%8A%A5%E9%94%99/" style="font-size: 1.15em; color: rgb(173, 131, 188)">报错</a><a href="/tags/exit/" style="font-size: 1.15em; color: rgb(16, 192, 76)">exit</a><a href="/tags/pwn%E6%8A%80%E5%B7%A7/" style="font-size: 1.15em; color: rgb(68, 85, 58)">pwn技巧</a><a href="/tags/fuzz/" style="font-size: 1.15em; color: rgb(119, 7, 177)">fuzz</a><a href="/tags/IO-FILE/" style="font-size: 1.2em; color: rgb(117, 12, 86)">_IO_FILE</a><a href="/tags/ida/" style="font-size: 1.15em; color: rgb(60, 116, 162)">ida</a><a href="/tags/kernel/" style="font-size: 1.25em; color: rgb(174, 157, 32)">kernel</a><a href="/tags/how2heap/" style="font-size: 1.15em; color: rgb(172, 20, 197)">how2heap</a><a href="/tags/heap/" style="font-size: 1.2em; color: rgb(45, 79, 31)">heap</a><a href="/tags/%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5/" style="font-size: 1.15em; color: rgb(163, 18, 43)">安全检查</a><a href="/tags/glibc/" style="font-size: 1.2em; color: rgb(65, 83, 176)">glibc</a><a href="/tags/%E5%A0%86/" style="font-size: 1.35em; color: rgb(74, 25, 35)">堆</a><a href="/tags/llvm-pass/" style="font-size: 1.15em; color: rgb(2, 165, 90)">llvm-pass</a><a href="/tags/pwnable-tw/" style="font-size: 1.15em; color: rgb(120, 43, 40)">pwnable.tw</a><a href="/tags/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" style="font-size: 1.15em; color: rgb(173, 159, 158)">刷题记录</a><a href="/tags/phppwn/" style="font-size: 1.15em; color: rgb(162, 46, 32)">phppwn</a><a href="/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 1.15em; color: rgb(11, 52, 5)">环境搭建</a><a href="/tags/linux/" style="font-size: 1.15em; color: rgb(78, 125, 62)">linux</a><a href="/tags/%E6%9D%82%E7%83%A9/" style="font-size: 1.15em; color: rgb(127, 188, 171)">杂烩</a><a href="/tags/%E6%8A%80%E5%B7%A7/" style="font-size: 1.15em; color: rgb(109, 6, 125)">技巧</a><a href="/tags/DynELF/" style="font-size: 1.15em; color: rgb(39, 172, 75)">DynELF</a><a href="/tags/mprotect/" style="font-size: 1.15em; color: rgb(132, 28, 56)">mprotect</a><a href="/tags/vsyscall/" style="font-size: 1.15em; color: rgb(123, 185, 180)">vsyscall</a><a href="/tags/setcontext/" style="font-size: 1.15em; color: rgb(5, 185, 157)">setcontext</a><a href="/tags/pyjail/" style="font-size: 1.15em; color: rgb(148, 75, 52)">pyjail</a></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ixout</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/cursor.js"></script><script async src="/js/fps.js"></script><script async src="/js/title.js"></script><script src="/js/sun_moon.js" async></script><script async src="//at.alicdn.com/t/c/font_3930344_38rvofbfw64.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="20px" data-random="false" async="async"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>